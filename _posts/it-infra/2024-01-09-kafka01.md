---
title: "[Infra] 아파치 카프카(kafka) 개념" 
categories:
  - it-infra
tags:
  - it-infra
use_math: true
toc: true
toc_label: "My Table of Contents"
toc_icon: "cog"
sidebar:
  title: "AI Machine Learning"
  nav: sidebar-contents
---

# 아파치 카프카(kafka)의 개념

## 1. 아파치 카프카의 탄생 

여러분들은 링크드인이라는 회사를 아시나요? 
링크드인은 비즈니스 소셜 네트워크 서비스인데, 취준생이나 직장인 분들이라면 잘 아실 겁니다. 
아파치 카프카는 링크드인의 데이터 통합 문제를 해결하기 위해 2010년에 개발되어 2011년에 출시되었습니다. 
그리고 2012년에는 아파치 재단의 인큐베이션 프로젝트로 시작했습니다. 
데이터는 단순히 트랜잭션의 기록에 머물지 않고, 
페이지 전환 데이터 및 운용에 관한 정보, 
애플리케이션 로그 등 비즈니스 관련 지표도 포함되어 있습니다. 
링크드인에서는 웹사이트에서 생성되는 로그를 처리해 사용자의 웹사이트 활동을 추적하는 것을 목적으로 개발되었습니다. 
이를 위해 사용자의 페이지뷰, 검색시 키워드 등을 수집해 서비스를 개선하는 것이 목적이었습니다.
링크드인에서는 바로 이런 데이터를 모아 실시간으로 이용자에게 제공할 수 있는 시스템이 필요했지만
전통적인 메시징 시스템으로는 어려웠습니다. 
왜냐하면 전통적인 메시징 시스템의 경우 대부분 트랜잭션 데이터를 처리하도록 설계되어 있었기 때문입니다.  
이를 가능하게 만든것이 카프카인데, 카프카는 대규모 메시징 시스템을 구현하기 위한 오픈소스 소프트웨어로 인기입니다. 

## 2. 아파치 카프카

아파치 카프카(Apache Kafka)는 여러대의 분산 서버에서 대량의 데이터를 처리하는 분산 메시징 시스템입니다. 
메시지(데이터)를 받고, 받은 메시지를 다른 시스템이나 장치에 보내기 위해 사용합니다. 
따라서 카프카는 여러 시스템을 연결하는 중요한 역할을 합니다.
또한 카프카는 대량의 데이터를 높은 처리량(high horoughput)과 실시간으로 처리하기 위한 소프트웨어 입니다. 

## 3. 카프카 구조  

카프카로부터 요구하는 사항은 다음과 같습니다. 

(1) 높은 처리량으로 실시간 처리한다. 
(2) 임의의 타이밍에 데이터를 읽는다.
(3) 다양한 제품과시스템에 쉽게 연동한다. 

위와 같은 요구사항을 만족하기 위해 카프카에서는 메시징 모델을 사용하는데, 
메시징 모델은 다음과 같은 세 가지 요소로 구성됩니다. 

* Producer: 메시지 생산자, 카프카에 데이터를 만들어서 주는 역할 
* Broker: 메시지 수집/전달 역할
* Consumer: 메시지 소비자, 카프카에서 데이터를 빼내서 소비하는 역할  
* zookeepker: 카프카의 정상 동작을 보장하기 위해 메타데이터를 관리하는 코디네이터, 노드 관리, 토픽관리, 컨트롤러 관리등 중요한 역할을 함. 2022년 초 무렵부터는 주키퍼가 삭제된 카프카 버전 릴리스.   

그리고 다음과 같은 것들도 있습니다. 

* Topic: 데이터를 최종적으로 저장하는 곳 
* replication: 메시지들을 여러개로 복제해서 카프카 클러스터 내 브러크들에 분산시키는 동작을 의미.
* partition: 하나의 토픽이 한번에 처리할 수 있는 한계를 높이기 위해 토픽 하나를 여러개로 나눠 병렬처리가 가능하게 만든 것
* segment: 프로듀서에 의해 보로커로 전송된 메시지는 토픽의 파티션에 저장되며, 각 메시지들은 세그먼트라는 로그 파일의 형태로 브로커의 로컬 디스크에 저장됨.
* 카프카 > 토픽 > 파티션 > 세그먼트 

## 4. 카프카 내부 동작 원리

### 4.1. 카프카 리플리케이션 

카프카 클러스터는 데이터 파이프라인에서 가장 중앙에서 허브 역할을 합니다. 
만약 카프카 클러스터가 하드웨어 문제나 점검 등으로 정상적인 동작을 못한다면 
카프카와 연결된 전체 파이프 라인에 영향을 미칠수 있고 이는 매우 심각한 문제로 이어질 수 있습니다. 
따라서 카프카는 초기 설계 단계부터 일시적인 하드웨어 이슈등으로 브로커 한 두대에서 장애가 발생하더라도 중앙 데이터 허브로서 안정적인 서비스가 운영될 수 있도록 구상되었습니다. 
이를 위해 토픽 생성 시 필수값으로 replication factor라는 옵션을 설정해야 합니다. 

카프카 내부 동작 원리에서 가장 중요한 부분 중 하나는 레플리케이셔 동작입니다.  
카프카 뿐만 아니라 일반적인 분산 시스템에서는 애플리케이션의 고가용성을 위해 
내부적으로 레플리케이션 동작을 하게 되는데, 그러나 이는 말만큼 쉽지 않습니다. 


