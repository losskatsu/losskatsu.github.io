---
title: "DHCP(Dynamic Host Configuration Protocol)란?" 
categories:
  - os-kernel
tags:
  - os
use_math: true
toc: true
toc_label: "My Table of Contents"
toc_icon: "cog"
sidebar:
  title: "AI Machine Learning"
  nav: sidebar-contents
---

# DHCP(Dynamic Host Configuration Protocol)란?

**참고 링크**

* [네트워크 기초(1) - OSI 7계층이란?](https://losskatsu.github.io/os-kernel/network-basic01/)
* [네트워크 기초(2) - 1계층: 물리계층](https://losskatsu.github.io/os-kernel/network-basic02/)
* [네트워크 기초(3) - 2계층: 데이터 링크 계층](https://losskatsu.github.io/os-kernel/network-basic03/)
* [네트워크 기초(4) - 3계층: 네트워크 계층](https://losskatsu.github.io/os-kernel/network-basic04/)
* [네트워크 기초(5) - 4계층: 전송 계층](https://losskatsu.github.io/os-kernel/network-basic05/)
* [네트워크 기초(6) - 5,6,7계층: 응용 계층](https://losskatsu.github.io/os-kernel/network-basic06/)
* [DNS 서버란?](https://losskatsu.github.io/os-kernel/etc-host-dns/)
* [DHCP 서버란?](https://losskatsu.github.io/os-kernel/dhcp/)



## 1. DHCP(Dynamic Host Configuration Protocol)란?

DHCP(Dynamic Host Configuration Protocol)란 IP 주소를 자동으로 할당해주는 그것입니다. 
따라서 DHCP(Dynamic Host Configuration Protocol) 서버는 IP 주소를 자동으로 할당해주는 서버를 의미합니다. 

## 2. DHCP의 역할

DHCP의 기본적인 역할은 IP 주소할당 입니다. 
DHCP 서버는 IP주소, 서브넷마스크, 디폴트 게이트웨이라는 기본 3종세트와 
DNS 서버의 IP 주소, 도메인 이름 같은 추가 정보를 제공합니다. 

다음 그림에서 알수 있듯 서브넷1의 PC가 서브넷2에 패킷을 전송할때는 
일단 라우터의 IP주소인 192.168.1.1에 패킷을 보낸다음 이후의 배송 처리는 라우터에게 부탁합니다. 
이처럼 다른 서브넷에 패킷을 전송할때 사용하는 라우터의 IP주소가 '디폴트 게이트웨이'입니다. 

<center><img src="/assets/images/os/dhcp/dhcp01.PNG" width="800"></center>

자신의 IP와 서브넷 마스크를 바탕으로 목적지  IP주소가 자신과 같은 서브넷인지 판단합니다. 
같은 서브넷이라면 상대편 PC에 직접 패킷을 전송하고, 
다른 서브넷이라면 라우터의 IP 주소로 패킷을 보냅니다. 
따라서 IP주소, 서브넷마스크, 디폴트게이트웨이라는 3종세트를 설정함으로써 
외부 서브넷과 통신할 수 있는 것입니다. 

DNS 서버는 이름을 해석할 때 필요한 정보를 주는 서버입니다. 
DNS 서버의 자세한 설명은 [링크](https://losskatsu.github.io/os-kernel/etc-host-dns/)를 참고해주세요.

## 3. DHCP의 IP 할당 과정

DHCP의 IP 할당 과정은 다음 그림과 같습니다. 

<center><img src="/assets/images/os/dhcp/dhcp02.PNG" width="800"></center>

각 단계를 순서대로 살펴보면

<center><img src="/assets/images/os/dhcp/dhcp05.PNG" width="800"></center>

위 그림을 자세히 설명하면

### 1) DHCP Discover

로컬 PC는 DHCP Discover 메시지를 동일한 서브넷에 브로드 캐스팅 메시지를 보냅니다. 
브로드 캐스트로 보내므로 메시지의 destination MAC 주소는 FF:FF:FF:FF:FF:FF로 설정합니다. 
즉, 이 메시지는 동일한 서브넷 네트워크상의 모든 DHCP 서버에 도달하게 됩니다. 

### 2) DHCP Offer

DHCP 서버가 로컬 PC로부터 DHCP Discover 메시지를 받으면 DHCP는 자신을 이용가능하다고 답을 보냅니다. 
이 메시지는 다음과 같은 정보를 포함해서 브로드 캐스트로 답을 보냅니다. 

* IP 주소
* subnet mask
* default gateway IP 주소
* DNS IP 주소
* IP lease time(IP 주소 임대 기간)
* DHCP 서버 주소

### 3) DHCP Request

로컬 PC가 DHCP 서버로 부터 메시지를 받으면 로컬 PC는 같은 서브넷 상에서 이용가능한 DHCP 서버가 존재한다는 사실을 알아챕니다. 
그리고나서 로컬 PC는 메시지를 받은 DHCP 서버에게 아까 받은 정보로 IP 주소 설정해달라고 합니다. 

### 4) DHCP Ack 

로컬 PC의 응답을 받은 DHCP 서버들은 option 54를 확인해서 자신에게 보낸 메시지가 맞는지 확인합니다. 
만약 자신에게 보낸게 맞다면 브로드 캐스트로 DHCP Ack 메시지를 보냅니다.

이때 DHCP는 모든 네트워크 설정 정보를 포함해서 메시지를 보내는데 다음과 같은 정보를 포함합니다. 

* IP 주소
* subnet mask
* default gateway IP 주소
* DNS IP 주소
* IP lease time(IP 주소 임대 기간)



참고: [넷매니아](https://www.netmanias.com/en/post/techdocs/5998/dhcp-network-protocol/understanding-the-basic-operations-of-dhcp)
